### Resource

* 接口定义

```java
public interface Resource extends InputStreamSource {
    boolean exists();	// 文件是否物理存在
    boolean isOpen();	// 
    URL getURL() throws IOException;
    File getFile() throws IOException;
    Resource createRelative(String relativePath) throws IOException;
    String getFilename();
    String getDescription();
}
```

* 主要接口实现类

```java
UrlResource
ClassPathResource
FileSystemResource
ServletContextResource
InputStreamResource
ByteArrayResource
```



### ResourceLoader

* 资源加载器顶层接口

```java
public interface ResourceLoader {
    Resource getResource(String location);
    ClassLoader getClassLoader();
}
```

* 资源匹配加载器

```java
public interface ResourcePatternResolver extends ResourceLoader {
    Resource[] getResources(String locationPattern) throws IOException;
}
```

* 应用上下文

```java
public interface ApplicationContext extends EnvironmentCapable, ListableBeanFactory, 	HierarchicalBeanFactory,
		MessageSource, ApplicationEventPublisher, ResourcePatternResolver {
            String getId();
            String getApplicationName();
            String getDisplayName();
            long getStartupDate();
            ApplicationContext getParent();
            AutowireCapableBeanFactory getAutowireCapableBeanFactory() throws IllegalStateException;
}
```

```java
public interface ConfigurableApplicationContext extends ApplicationContext, Lifecycle, Closeable {
    void addApplicationListener(ApplicationListener<?> listener);
    void addBeanFactoryPostProcessor(BeanFactoryPostProcessor postProcessor);
    void addProtocolResolver(ProtocolResolver resolver);
    ConfigurableListableBeanFactory getBeanFactory() throws IllegalStateException;
    ConfigurableEnvironment getEnvironment();
    boolean isActive();
    void refresh() throws BeansException, IllegalStateException;
    void registerShutdownHook();
    void setEnvironment(ConfigurableEnvironment environment);
    void setId(String id);
    void setParent(ApplicationContext parent);
}
```



### ClassPathXmlApplicationContext构造过程

1. 构造函数传入路径名

```java
new ClassPathXmlApplicationContext("classpath:spring/applicationContext-${spring.profile}.xml");
```

ClassPathXmlApplicationContext调用setConfigLocations方法存储资源路径

```java
setConfigLocations(configLocations);
```

针对每一个资源路径，解析其中的点位符，比如${spring.profile}，还未加载任务配置文件之前，默认通过系统环境变量、JVM启动参数等进行解析

```java
resolvePath(path)->getEnvironment().resolveRequiredPlaceholders(path)
    ->new StandardEnvironment().resolveRequiredPlaceholders(path)
    ->new PropertySourcesPropertyResolver().resolvePlaceholders(text)
```

通配符的匹配方法

```java
AntPathMatcher.doMatch()	// 文件匹配
```

对bean进行加载

```java
AbstractApplicationContext.refresh
AbstractApplicationContext.obtainFreshBeanFactory
-> AbstractRefreshableApplicationContext.refreshBeanFactory
-> AbstractXmlApplicationContext.loadBeanDefinitions
-> AbstractBeanDefinitionReader.loadBeanDefinitions
```

